# エラーページ・404ページの表示タイミング

## 概要
このドキュメントでは、カスタム404ページとエラーページがいつ表示されるかを明確に説明します。

## 404ページ（Not Found）
**ファイル**: `src/app/not-found.tsx`

### 表示されるタイミング
1. **存在しないURLにアクセスした場合**
   - 例: `/unknown-page`, `/card/999`, `/deck/abc`など
   - Next.jsが自動的にnot-found.tsxを呼び出す

2. **明示的に404を返す場合**
   - アプリケーション内でnotFound()関数を呼び出した場合
   - データが見つからない場合の意図的な404レスポンス

3. **本番環境でのテストページアクセス**
   - `/auth-test` - 本番環境では404ページが表示される
   - `/error-test` - 本番環境では404ページが表示される

### 表示内容
- タイトル: "404"
- メッセージ: "お探しのページが見つかりませんでした"
- ホームに戻るボタン
- フッター（サイト情報）

## エラーページ（Error Boundary）
**ファイル**: `src/app/error.tsx`

### 表示されるタイミング
1. **予期しないJavaScriptエラー**
   - コンポーネント内での例外発生
   - レンダリング時のエラー
   - イベントハンドラー内でのエラー

2. **APIエラー（未処理）**
   - fetch失敗時の未処理エラー
   - サーバーからの5xxエラーレスポンス

3. **開発・ステージング環境でのテスト**
   - `/error-test`ページでエラーを意図的に発生させた場合

### 表示内容
- タイトル: "ERROR" 
- メッセージ: "予期しないエラーが発生しました"
- サブメッセージ: エラーの状況説明
- 再試行ボタン（赤いボーダーデザイン）
- ホームに戻るボタン（下部）
- エラー詳細（ステージング環境のみ）
- フッター（サイト情報）

## 環境別の動作

### 開発・ステージング環境 (`NEXT_PUBLIC_IS_STAGING=true`)
- **全機能有効**: 404ページ、エラーページ、テストページすべて利用可能
- **エラー詳細表示**: エラーページでスタックトレース表示
- **テストページアクセス可能**: `/auth-test`, `/error-test`

### 本番環境 (`NEXT_PUBLIC_IS_STAGING≠true`)
- **基本機能のみ**: 404ページ、エラーページのみ
- **エラー詳細非表示**: セキュリティのためエラー詳細は隠蔽
- **テストページ無効**: `/auth-test`, `/error-test`は404ページを表示

## 設計原則
1. **統一されたデザイン**: 両ページとも同じ背景・レイアウト
2. **共通フッター**: PageFooterコンポーネントで統一
3. **アクセシビリティ**: 適切なARIAラベルとrole属性
4. **SEO対応**: 404ページにはnoindex, nofollowを設定
5. **環境分離**: 本番環境では不要な情報を非表示

## 関連ファイル
- `src/app/not-found.tsx` - 404ページルート
- `src/app/error.tsx` - エラーページルート  
- `src/components/NotFoundPage.tsx` - 404表示コンポーネント
- `src/components/ErrorPage.tsx` - エラー表示コンポーネント
- `src/components/PageFooter.tsx` - 共通フッター
- `src/components/HomeButton.tsx` - 共通ホームボタン
- `src/app/error-test/page.tsx` - エラーテスト用ページ
- `src/components/ErrorTestPage.tsx` - エラーテスト用コンポーネント