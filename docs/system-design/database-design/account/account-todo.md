# アカウント管理システム - TODO・将来実装項目まとめ

## 概要

アカウント管理システムの設計ドキュメントで言及されている未実装機能、将来実装予定項目、推奨事項をまとめたTODOリストです。
優先度と実装時期に基づいて整理しています。

## 優先度: 高（即座実装が必要）

### 認証・認可基盤
- [ ] **認可ミドルウェアの実装**（現在コード例のみ）
  - JWT検証ミドルウェア
  - 権限チェックミドルウェア
  - リクエストコンテキストへの管理者情報設定
- [ ] **JWT実装の完成**（@hono/jwt使用）
  - アクセストークンの署名・検証
  - リフレッシュトークンの署名・検証
  - トークン有効期限の厳密な管理
- [ ] **実際のデータベース接続実装**（現在はモック実装）
  - PostgreSQLアダプター実装
  - D1アダプター実装
  - コネクションプーリング

### セキュリティ強化
- [ ] **HttpOnly Cookieによるリフレッシュトークン保存**
- [ ] **CSRFトークン実装**
- [ ] **システム予約語の使用禁止チェック**（AdminUsernameのバリデーション拡張）

## 優先度: 中（短期実装予定）

### データベース・インフラ
- [ ] **データベースマイグレーションの自動実行**
  - CI/CDパイプラインとの統合
  - ロールバック機能
  - バージョン管理
- [ ] **レート制限の本番実装**（Redis使用推奨）
  - 分散環境対応
  - 柔軟な制限ルール設定
- [ ] **データ保持期間の自動クリーンアップ実装**
  - セッション: 30日間
  - アクティビティログ: 1年間

### ビジネスルール実装
- [ ] **パスワード履歴管理**（過去パスワードの再利用禁止）
- [ ] **初期パスワードの強制変更機能**
- [ ] **アカウントロック機能**（一時的なアクセス禁止）
- [ ] **最後のスーパー管理者削除防止の実装**
- [ ] **セッション数制限**（同時ログイン数の上限設定）

### セキュリティ機能
- [ ] **CAPTCHA導入**（ブルートフォース攻撃対策）
- [ ] **Content Security Policyの詳細設定**
- [ ] **個人情報の暗号化実装**
  - 保存時の暗号化
  - 転送時の暗号化

## 優先度: 低（長期実装予定）

### パフォーマンス最適化
- [ ] **パーティショニング実装**（ログテーブル肥大化対策）
- [ ] **権限チェックのキャッシュ実装**
- [ ] **インデックス効率性の定期監視ツール**
- [ ] **ログ分析自動化ツール**

### ドメイン駆動設計
- [ ] **ドメインイベント実装**
  - イベントストアの実装
  - イベントハンドラーの実装
  - イベントソーシングの導入

### 監査・コンプライアンス
- [ ] **監査ログの改ざん防止機構**（署名・ハッシュチェーン）
- [ ] **ログの長期保存アーカイブ**
- [ ] **セキュリティアラートの自動通知**
- [ ] **GDPR対応機能**
  - データ削除権（忘れられる権利）
  - データポータビリティ
  - 同意管理
- [ ] **個人情報保護法対応の詳細実装**

### 運用自動化
- [ ] **バックアップ・リストア手順の自動化**
- [ ] **セキュリティパッチ自動適用**
- [ ] **脆弱性スキャンの定期実行**
- [ ] **パスワード90日変更ポリシーの強制化**

## 将来の拡張機能

### 多要素認証（MFA）
- [ ] **SMS認証**
- [ ] **TOTPアプリ**（Google Authenticator等）
- [ ] **ハードウェアトークン**
- [ ] **生体認証**

### 高度なセキュリティ機能
- [ ] **異常行動検知**
- [ ] **機械学習ベースの脅威検知**
- [ ] **ゼロトラストアーキテクチャ**
- [ ] **特権アクセス管理（PAM）**

### 外部認証連携
- [ ] **SAML SSO**
- [ ] **OAuth 2.0 / OpenID Connect**
- [ ] **LDAP / Active Directory**
- [ ] **企業 IdP 連携**
- [ ] **認証プロバイダーインターフェース設計**
- [ ] **プラグインアーキテクチャの準備**

## 実装ロードマップ

### Phase 1（1-2ヶ月）
1. 認可ミドルウェア実装
2. JWT完全実装
3. データベース接続実装
4. HttpOnly Cookie実装

### Phase 2（3-4ヶ月）
1. セキュリティ強化機能
2. ビジネスルール実装
3. Redis導入
4. 自動化ツール整備

### Phase 3（5-6ヶ月）
1. パフォーマンス最適化
2. 監査機能強化
3. コンプライアンス対応

### Phase 4（7ヶ月以降）
1. MFA実装
2. 外部認証連携
3. 高度なセキュリティ機能

## 技術的債務

### 現在のモック実装
- JWT生成・検証（簡易実装）
- データベース接続（モックデータ返却）
- bcryptフォールバック（簡易ハッシュ）

### 改善が必要な実装
- インメモリレート制限（分散環境非対応）
- セッション管理（リアルタイム同期なし）
- ログローテーション（未実装）

## 注意事項

1. **セキュリティ関連の実装は最優先**で対応する
2. **本番環境移行前**に高優先度項目は必ず実装する
3. **外部認証連携**は別プロジェクトとして計画する
4. **パフォーマンス最適化**は負荷テスト結果に基づいて実施する

## 関連ドキュメント

- [アカウント管理システム - データベース設計](./account-database-design.md)
- [アカウント管理システム - ドメインモデル設計](./account-domain-model.md)
- [アカウント管理システム - セキュリティ設計](./account-security-design.md)